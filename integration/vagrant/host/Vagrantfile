@BOX_URL="http://c629296.r96.cf2.rackcdn.com"

Vagrant::Config.run do |global_config|
  # Host config
  global_config.vm.define :host do |config|
      if ! ENV['GLANCEIMAGES']
        raise ArgumentError, "GLANCEIMAGES environment variable not defined."
      end
      if ! ENV['GLANCESRC']
        raise ArgumentError, "GLANCESRC environment variable not defined."
      end

      # Assign this VM to a host only network IP, allowing you to access it
      # via the IP. The IP for the volume vm is "33.33.33.10"
      config.vm.network "33.33.33.11"

      config.vm.box = "lucid_ext3_openvz"
      config.vm.box_url = @BOX_URL + "#{config.vm.box}.box"
      config.vm.host_name = "host"

      config.vm.share_folder "glance", "/glance", ENV['GLANCESRC']
      config.vm.share_folder "glance_images", "/glance_images", ENV['GLANCEIMAGES']
      config.vm.share_folder "nova", "/src", "../../../"
      if ENV['RSDNS']
        rsdns_dir = ENV['RSDNS']
        if File.directory?(rsdns_dir)
            config.vm.share_folder "rsdns", "/rsdns", ENV['RSDNS']
        end
      end
      config.vm.share_folder "vagrant-common", "/vagrant-common", "./../common"
      config.vm.share_folder "tests", "/tests", "./../../"
  end

  # Volume Config
  global_config.vm.define :volume do |config|
    config.vm.box = "volumeserver"
    config.vm.box_url = @BOX_URL + "#{config.vm.box}.box"
    config.vm.host_name = "volume"
    config.vm.network "33.33.33.10"
    config.vm.share_folder "vagrant-common", "/vagrant-common", "./../common"
  end
end
